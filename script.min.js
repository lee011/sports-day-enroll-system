function refreshCurrent(){if(history.state===null)jQuery(backButton).hide(),document.title=lang.title,loadMainPage();else switch(history.state.l){case"main":jQuery(backButton).hide();document.title=lang.title;loadMainPage();break;case"enroll":jQuery(backButton).show();document.title=lang.enroll_title+" - "+lang.title;loadEnrollPage();break;case"stat":jQuery(backButton).show();document.title=lang.stat_title+" - "+lang.title;loadStatPage()}}function loadMainPage(){document.title=lang.title;$(progressBar).fadeIn(200);$("#mainContent").fadeOut(200,function(){$.ajax({url:"main.html",cache:!1}).done(function(n){$(progressBar).fadeOut(200);$(mainContent).html(n).fadeIn(200)}).fail(function(n,t,i){$(progressBar).fadeOut(200);toast.text=n.status==404?lang.network_error:lang.error+i;toast.open()})})}function loadEnrollPage(){document.title=lang.enroll_title+" - "+lang.title;$(progressBar).fadeIn(200);$("#mainContent").fadeOut(200,function(){$.ajax({url:"enroll.html",cache:!1}).done(function(n){$(progressBar).fadeOut(200);$(mainContent).html(n).fadeIn(200)}).fail(function(n){$(progressBar).fadeOut(200);switch(n.status){case 403:toast.text=loggedin?lang.timeout:lang.login_required;toast.open();loadMainPage();break;case 404:toast.text=lang.network_error;toast.open();break;case 500:toast.text=lang.system_error;toast.open()}})})}function loadStatPage(){document.title=lang.stat_title+" - "+lang.title;$(progressBar).fadeIn(200);$("#mainContent").fadeOut(200,function(){$.ajax({url:"stat.html",cache:!1}).done(function(n){$(progressBar).fadeOut(200);$(mainContent).html(n).fadeIn(200)}).fail(function(n){$(progressBar).fadeOut(200);switch(n.status){case 403:toast.text=loggedin?lang.timeout:lang.login_required;toast.open();loadMainPage();break;case 404:toast.text=lang.network_error;toast.open();break;case 500:toast.text=lang.system_error;toast.open()}})})}function validateEntries(){var i=jQuery(firstiev.selectedItem),n=jQuery(secondiev.selectedItem),t=jQuery(thirdiev.selectedItem);if(firstiev.invalid=!1,secondiev.invalid=!1,thirdiev.invalid=!1,i.data("id")!=""||n.data("id")!=""||t.data("id")!=""){if(i.data("id")!=""){if(n.data("id")!=""&&i.data("id")==n.data("id")){secondiev.invalid=!0;secondiev.errorMessage=lang.duplicate_selection;return}if(t.data("id")!=""&&i.data("id")==t.data("id")){thirdiev.invalid=!0;thirdiev.errorMessage=lang.duplicate_selection;return}}if(n.data("id")!=""&&t.data("id")!=""&&n.data("id")==t.data("id")){thirdiev.invalid=!0;thirdiev.errorMessage=lang.duplicate_selection;return}if(i.data("type")=="TI"&&n.data("type")=="TI"&&t.data("type")=="TI"||i.data("type")=="F"&&n.data("type")=="F"&&t.data("type")=="F"){thirdiev.invalid=!0;thirdiev.errorMessage=lang.too_many;return}}}function validateRelayTeam(){var i="",t,n;relayItemSelect.invalid=!1;relayItemSelect.selectedItem==null?(relayItemSelect.invalid=!0,relayItemSelect.errorMessage=lang.field_required):(t=jQuery(relayItemSelect.selectedItem),i=t.data("id"));n=jQuery(".memberSelect").toArray();n.forEach(function(n){n.invalid=!1;n.selectedItem==null&&(n.invalid=!0,n.errorMessage=lang.field_required)});n[0].selectedItem!=null&&(n[0].contentElement.selected==n[1].contentElement.selected&&(n[1].invalid=!0,n[1].errorMessage=lang.duplicate_selection),n[0].contentElement.selected==n[2].contentElement.selected&&(n[2].invalid=!0,n[2].errorMessage=lang.duplicate_selection),n[0].contentElement.selected==n[3].contentElement.selected&&(n[3].invalid=!0,n[3].errorMessage=lang.duplicate_selection));n[1].selectedItem!=null&&(n[1].contentElement.selected==n[2].contentElement.selected&&(n[2].invalid=!0,n[2].errorMessage=lang.duplicate_selection),n[1].contentElement.selected==n[3].contentElement.selected&&(n[3].invalid=!0,n[3].errorMessage=lang.duplicate_selection));n[2].selectedItem!=null&&n[2].contentElement.selected==n[3].contentElement.selected&&(n[3].invalid=!0,n[3].errorMessage=lang.duplicate_selection)}function checkRelayTeam(){var r="",i,n,t;if(relayItemSelect.selectedItem==null)return statusEnum.required;for(i=jQuery(relayItemSelect.selectedItem),r=i.data("id"),n=jQuery(".memberSelect").toArray(),t=0;t<n.length;t++)if(n[t].selectedItem==null)return statusEnum.required;return n[0].selectedItem!=null&&(n[0].contentElement.selected==n[1].contentElement.selected||n[0].contentElement.selected==n[2].contentElement.selected||n[0].contentElement.selected==n[3].contentElement.selected)?statusEnum.duplicated:n[1].selectedItem!=null&&(n[1].contentElement.selected==n[2].contentElement.selected||n[1].contentElement.selected==n[3].contentElement.selected)?statusEnum.duplicated:n[2].selectedItem!=null&&n[2].contentElement.selected==n[3].contentElement.selected?statusEnum.duplicated:statusEnum.ok}function checkEntries(){var i=jQuery(firstiev.selectedItem),n=jQuery(secondiev.selectedItem),t=jQuery(thirdiev.selectedItem);return i.data("id")==""&&n.data("id")==""&&t.data("id")==""?statusEnum.ok:i.data("id")!=""&&(n.data("id")!=""&&i.data("id")==n.data("id")||t.data("id")!=""&&i.data("id")==t.data("id"))?statusEnum.duplicated:n.data("id")!=""&&t.data("id")!=""&&n.data("id")==t.data("id")?statusEnum.duplicated:i.data("type")=="TI"&&n.data("type")=="TI"&&t.data("type")=="TI"||i.data("type")=="F"&&n.data("type")=="F"&&t.data("type")=="F"?statusEnum.tooMany:statusEnum.ok}function showEntryErrorDialog(n){switch(n){case statusEnum.duplicated:$("#dialog5 .dialog-text").text(lang.duplicate_selection);break;case statusEnum.notInOrder:$("#dialog5 .dialog-text").text(lang.not_in_order);break;case statusEnum.tooMany:$("#dialog5 .dialog-text").text(lang.too_many)}dialog5.open()}function showRelayTeamErrorDialog(n){switch(n){case statusEnum.duplicated:$("#dialog9 .dialog-text").text(lang.duplicate_selection);break;case statusEnum.required:$("#dialog9 .dialog-text").text(lang.all_fields_required);break;case statusEnum.registered:$("#dialog9 .dialog-text").text(lang.relay_team_registered)}dialog9.open()}function showRelayTeamDialog(){$.ajax({url:"relayTeamDialog.html"}).done(function(n){$(relayTeamContent).html(n);dialog8.open()})}function sendEntries(){var n;if((n=checkEntries())==statusEnum.ok){var t=jQuery(firstiev.selectedItem),i=jQuery(secondiev.selectedItem),r=jQuery(thirdiev.selectedItem);$(progressBar).fadeIn(200);$.ajax({url:"handleEnroll.html",method:"POST",data:{firstiev:t.data("id"),secondiev:i.data("id"),thirdiev:r.data("id"),rev:"",locked:"0",lockpwd:""},dataType:"json"}).done(function(n){n.success==1?(toast.text=lang.item_updated,toast.open(),refreshCurrent()):($(progressBar).fadeOut(200),toast.text=lang.error+"("+n.error.code+")"+n.error.message,toast.open())})}else showEntryErrorDialog(n)}function sendRelayTeam(){var t,i,n;(t=checkRelayTeam())==statusEnum.ok?(i=jQuery(relayItemSelect.selectedItem),n=jQuery(".memberSelect").toArray(),$(progressBar).fadeIn(200),$.ajax({url:"handleRelayTeam.html",method:"POST",data:{ev:i.data("id"),member1:$(n[0].selectedItem).data("id"),member2:$(n[1].selectedItem).data("id"),member3:$(n[2].selectedItem).data("id"),member4:$(n[3].selectedItem).data("id")},dataType:"json"}).done(function(n){n.success==1?(toast.text=lang.item_added,toast.open(),refreshCurrent(),dialog8.close()):n.success==-1?($(progressBar).fadeOut(200),showRelayTeamErrorDialog(statusEnum.registered)):($(progressBar).fadeOut(200),toast.text=lang.error+"("+n.error.code+")"+n.error.message,toast.open())})):showRelayTeamErrorDialog(t)}function deleteRelayTeam(){var n=jQuery(relayTeamsList.selectedItem);$(progressBar).fadeIn(200);$.ajax({url:"deleteRelayTeams.html",method:"POST",data:{id:n.data("id")},dataType:"json"}).done(function(n){n.success==1?(toast.text=lang.item_deleted,toast.open(),refreshCurrent()):($(progressBar).fadeOut(200),toast.text=lang.error+"("+n.error.code+")"+n.error.message,toast.open())})}function confirmRelayTeam(){var n=jQuery(relayTeamsList.selectedItem);$(progressBar).fadeIn(200);$.ajax({url:"confirmRelayTeam.html",method:"POST",data:{id:n.data("id"),pos:n.data("pos")},dataType:"json"}).done(function(n){n.success==1?(toast.text=lang.item_updated,toast.open(),refreshCurrent()):($(progressBar).fadeOut(200),toast.text=lang.error+"("+n.error.code+")"+n.error.message,toast.open())})}function timerIncrement(){loggedin&&(idleTime++,idleTime>timeout-1?(loggedin=!1,dialog6.close(),$(progressBar).fadeIn(200),$.ajax({url:"logout.html",cache:!1}).done(function(){usertype="";captchaValue="";loadMainPage();toast.text=lang.logout;toast.open()}).fail(function(n,t,i){$(progressBar).fadeOut(200);toast.text=n.status==404?lang.network_error:lang.error+i;toast.open()}),dialog7.open()):idleTime>timeout-121&&(dialog6.opened||dialog6.open(),$("#idlecount").text(timeout-idleTime)))}function resetEntry(){reset=!0;firstiev.contentElement.selected=0;secondiev.contentElement.selected=0;thirdiev.contentElement.selected=0;reset=!1}var usertype,captchaValue="",loggedin=!1,reset=!1,recaptchaAvailable=!1,idleTime=0,timeout=600,statusEnum,onloadCallback;jQuery.holdReady(!0);$(function(){var t=setInterval(timerIncrement,1e3);$(this).mousemove(function(){idleTime=0;dialog6.opened&&dialog6.close()});$(this).keypress(function(){idleTime=0;dialog6.opened&&dialog6.close()});$(document).on("click","#loginButton",function(){c.value==""||n.value==""||p.value==""?dialog1.open():n.invalid?dialog3.open():($(progressBar).fadeIn(200),$("#bg").fadeOut(200),$.ajax({url:"handleLogin.html",data:{u:c.value,p:p.value,n:n.value,c:captchaValue},dataType:"json",method:"post",cache:!1}).done(function(n){typeof n=="string"?($("#bg").fadeIn(200),console.log(n)):(n.success!=1&&$("#bg").fadeIn(200),n.success==1?(toast.text=lang.login_success,toast.open(),refreshCurrent()):n.success==0?($(progressBar).fadeOut(200),toast.text=lang.login_error_pwd,toast.open()):n.success==-1?($(progressBar).fadeOut(200),toast.text=lang.login_error_unknown,toast.open()):n.success==-2?($(progressBar).fadeOut(200),toast.text=lang.login_error_missing_info,toast.open()):n.success==-3?($(progressBar).fadeOut(200),toast.text=lang.login_error_not_ready,toast.open()):n.success==-4?($(progressBar).fadeOut(200),toast.text=lang.login_error_verification,toast.open(),console.log(n.error),console.log(n.jsontext)):n.success==-5&&($(progressBar).fadeOut(200),toast.text=lang.login_error_blocked,toast.open()))}).fail(function(n,t,i){$("#bg").fadeIn(200);$(progressBar).fadeOut(200);toast.fitInto=document.querySelector("#loginPanel");toast.text=n.status==404?lang.network_error:lang.error+i;toast.open();console.log(n.responseText)}))});$(document).on("click","#logoutLink",function(){$(progressBar).fadeIn(200);$.ajax({url:"logout.html",cache:!1}).done(function(){usertype="";captchaValue="";loadMainPage();toast.text=lang.logout;toast.open()}).fail(function(n,t,i){$(progressBar).fadeOut(200);toast.text=n.status==404?lang.network_error:lang.error+i;toast.open()})});if(history.state===null)jQuery(backButton).hide(),document.title=lang.title,loadMainPage();else switch(history.state.l){case"main":jQuery(backButton).hide();document.title=lang.title;loadMainPage();break;case"enroll":jQuery(backButton).show();document.title=lang.enroll_title+" - "+lang.title;loadEnrollPage();break;case"stat":jQuery(backButton).show();document.title=lang.stat_title+" - "+lang.title;loadStatPage()}window.onpopstate=function(n){if(n.state===null)jQuery(backButton).hide(),document.title=lang.title,loadMainPage();else switch(n.state.l){case"main":jQuery(backButton).hide();document.title=lang.title;loadMainPage();break;case"enroll":jQuery(backButton).show();document.title=lang.enroll_title+" - "+lang.title;loadEnrollPage();break;case"stat":jQuery(backButton).show();document.title=lang.stat_title+" - "+lang.title;loadStatPage()}};$(document.body).on("iron-select","#firstiev",function(){firstiev.contentElement.selected!=0||reset||(firstiev.contentElement.selected=secondiev.contentElement.selected,secondiev.contentElement.selected=thirdiev.contentElement.selected,thirdiev.contentElement.selected=0);secondiev.disabled=firstiev.contentElement.selected==0;thirdiev.disabled=secondiev.contentElement.selected==0;validateEntries()});$(document.body).on("iron-select","#secondiev",function(){secondiev.contentElement.selected!=0||reset||(secondiev.contentElement.selected=thirdiev.contentElement.selected,thirdiev.contentElement.selected=0);thirdiev.disabled=secondiev.contentElement.selected==0;validateEntries()});$(document.body).on("iron-select","#thirdiev",function(){validateEntries()});$(document.body).on("iron-select","#relayItemSelect, .memberSelect",function(){validateRelayTeam()})});statusEnum={ok:0,notInOrder:-1,duplicated:-2,tooMany:-3,required:-4,registered:-5};onloadCallback=function(){recaptchaAvailable=!0;recaptchacontainer&&grecaptcha.render(recaptchacontainer,{sitekey:"6LcbNxMTAAAAAJqw8rngqBFCofxVjUNdfzay7Rxj",callback:function(n){captchaValue=n;loginButton.disabled=!1},"expired-callback":function(){captchaValue="";loginButton.disabled=!0}})};window.addEventListener("WebComponentsReady",function(){jQuery.holdReady(!1);$(document.body).show()});